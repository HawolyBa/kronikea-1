{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\Utilisateur\\\\Documents\\\\CODE\\\\kronikea-master\\\\pages\\\\story\\\\[id]\\\\index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { useRouter } from \"next/router\";\nimport { Row, Col, message } from \"antd\";\nimport { connect } from \"react-redux\";\nimport { getStory, getChapters, getStoryCharacters, deleteChapter, isStoryFavorite, addStoryToFavorite, removeStoryFromFavorite, getStoryLocations } from \"../../../redux/actions/storiesActions\";\nimport { useAuth } from \"../../../hooks/userHooks\";\nimport RedirectComp from \"../../../components/hoc/RedirectComp\";\nimport LoadingScreen from \"../../../components/hoc/LoadingScreen\";\nimport Chapters from \"../../../components/story/Chapters\";\nimport Banner from \"../../../components/story/Banner\";\nimport { CharacterGrid, LocationGrid } from \"../../../components/common/Grid\";\n\nvar Story = function Story(_ref) {\n  _s();\n\n  var getStory = _ref.getStory,\n      getStoryLocations = _ref.getStoryLocations,\n      story = _ref.story,\n      loading = _ref.loading,\n      getChapters = _ref.getChapters,\n      chapters = _ref.chapters,\n      storyLocations = _ref.storyLocations,\n      getStoryCharacters = _ref.getStoryCharacters,\n      deleteChapter = _ref.deleteChapter,\n      actionMessage = _ref.actionMessage,\n      isStoryFavorite = _ref.isStoryFavorite,\n      isFavorite = _ref.isFavorite,\n      addStoryToFavorite = _ref.addStoryToFavorite,\n      storyExists = _ref.storyExists,\n      loadingFav = _ref.loadingFav,\n      removeStoryFromFavorite = _ref.removeStoryFromFavorite;\n  var router = useRouter();\n  var auth = useAuth();\n\n  var _React$useState = React.useState([]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      mains = _React$useState2[0],\n      setMains = _React$useState2[1];\n\n  var _React$useState3 = React.useState([]),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      secondaries = _React$useState4[0],\n      setSecondaries = _React$useState4[1];\n\n  var _React$useState5 = React.useState([]),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      chaptersArr = _React$useState6[0],\n      setChaptersArr = _React$useState6[1];\n\n  React.useEffect(function () {\n    getStory(router.query.id);\n    getChapters(router.query.id);\n    getStoryCharacters(router.query.id);\n    getStoryLocations(router.query.id);\n\n    if (!auth.isLoading) {\n      isStoryFavorite(router.query.id);\n    }\n  }, [router.query.id, auth]);\n  React.useEffect(function () {\n    if (actionMessage) {\n      message.success(actionMessage);\n      getChapters(router.query.id);\n    }\n  }, [actionMessage]);\n\n  var deleteChapterFunc = function deleteChapterFunc(id) {\n    deleteChapter(id, router.query.id);\n  };\n\n  React.useEffect(function () {\n    if (story.mainCharacters) {\n      setMains(story.mainCharacters.filter(function (c) {\n        return c[\"public\"] || c.authorId === auth.user.uid;\n      }));\n    }\n  }, [story]);\n  React.useEffect(function () {\n    if (story.secondaryCharacters) {\n      setSecondaries(story.secondaryCharacters.filter(function (c) {\n        return c[\"public\"] || c.authorId === auth.user.uid;\n      }));\n    }\n  }, [story]);\n  React.useEffect(function () {\n    if (chapters) {\n      setChaptersArr(chapters.filter(function (c) {\n        return c[\"public\"] || c.authorId === auth.user.uid;\n      }));\n    }\n  }, [chapters]);\n  return __jsx(LoadingScreen, {\n    loading: loading,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 5\n    }\n  }, __jsx(LoadingScreen, {\n    loading: loadingFav,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, __jsx(RedirectComp, {\n    type: \"404\",\n    condition: storyExists,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  }, __jsx(RedirectComp, {\n    type: \"403\",\n    condition: story[\"public\"] || auth.user && auth.user.uid === story.authorId,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"story\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }\n  }, __jsx(Row, {\n    gutter: 24,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }\n  }, __jsx(Banner, {\n    loading: loading,\n    story: story,\n    id: router.query.id,\n    isFavorite: isFavorite,\n    addStoryToFavorite: addStoryToFavorite,\n    removeStoryFromFavorite: removeStoryFromFavorite,\n    auth: auth,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 17\n    }\n  }), __jsx(Col, {\n    sm: 24,\n    md: 16,\n    lg: 18,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: \"story-chapters\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 19\n    }\n  }, __jsx(Chapters, {\n    chapters: chaptersArr,\n    id: router.query.id,\n    deleteChapter: deleteChapterFunc,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 21\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 21\n    }\n  }, \"Main Characters\"), __jsx(CharacterGrid, {\n    gutter: [24, 16],\n    xxl: 4,\n    xl: 4,\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"show\",\n    characters: mains,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 21\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 21\n    }\n  }, \"Secondary Characters\"), __jsx(CharacterGrid, {\n    gutter: [24, 16],\n    xxl: 4,\n    xl: 4,\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"show\",\n    characters: secondaries,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 21\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 21\n    }\n  }, \"Locations\"), __jsx(LocationGrid, {\n    locations: storyLocations,\n    gutter: [24, 16],\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"story\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 21\n    }\n  })))))))));\n};\n\n_s(Story, \"9e20YYukbxl+t/a/0dkprG989T8=\", false, function () {\n  return [useRouter, useAuth];\n});\n\n_c = Story;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    story: state.stories.story,\n    loading: state.stories.loading,\n    chapters: state.stories.chapters,\n    actionMessage: state.stories.message,\n    loadingChapter: state.stories.loadingChapter,\n    isFavorite: state.stories.isFavorite,\n    storyExists: state.stories.storyExists,\n    loadingFav: state.stories.loadingFav,\n    storyLocations: state.stories.storyLocations\n  };\n};\n\nexport default connect(mapStateToProps, {\n  getStory: getStory,\n  getChapters: getChapters,\n  getStoryCharacters: getStoryCharacters,\n  deleteChapter: deleteChapter,\n  isStoryFavorite: isStoryFavorite,\n  addStoryToFavorite: addStoryToFavorite,\n  removeStoryFromFavorite: removeStoryFromFavorite,\n  getStoryLocations: getStoryLocations\n})(Story);\n\nvar _c;\n\n$RefreshReg$(_c, \"Story\");","map":{"version":3,"sources":["C:/Users/Utilisateur/Documents/CODE/kronikea-master/pages/story/[id]/index.js"],"names":["React","useRouter","Row","Col","message","connect","getStory","getChapters","getStoryCharacters","deleteChapter","isStoryFavorite","addStoryToFavorite","removeStoryFromFavorite","getStoryLocations","useAuth","RedirectComp","LoadingScreen","Chapters","Banner","CharacterGrid","LocationGrid","Story","story","loading","chapters","storyLocations","actionMessage","isFavorite","storyExists","loadingFav","router","auth","useState","mains","setMains","secondaries","setSecondaries","chaptersArr","setChaptersArr","useEffect","query","id","isLoading","success","deleteChapterFunc","mainCharacters","filter","c","authorId","user","uid","secondaryCharacters","mapStateToProps","state","stories","loadingChapter"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { Row, Col, message } from \"antd\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport {\r\n  getStory,\r\n  getChapters,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  isStoryFavorite,\r\n  addStoryToFavorite,\r\n  removeStoryFromFavorite,\r\n  getStoryLocations,\r\n} from \"../../../redux/actions/storiesActions\";\r\nimport { useAuth } from \"../../../hooks/userHooks\";\r\n\r\nimport RedirectComp from \"../../../components/hoc/RedirectComp\";\r\nimport LoadingScreen from \"../../../components/hoc/LoadingScreen\";\r\nimport Chapters from \"../../../components/story/Chapters\";\r\nimport Banner from \"../../../components/story/Banner\";\r\nimport { CharacterGrid, LocationGrid } from \"../../../components/common/Grid\";\r\n\r\nconst Story = ({\r\n  getStory,\r\n  getStoryLocations,\r\n  story,\r\n  loading,\r\n  getChapters,\r\n  chapters,\r\n  storyLocations,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  actionMessage,\r\n  isStoryFavorite,\r\n  isFavorite,\r\n  addStoryToFavorite,\r\n  storyExists,\r\n  loadingFav,\r\n  removeStoryFromFavorite,\r\n}) => {\r\n  const router = useRouter();\r\n  const auth = useAuth();\r\n\r\n  const [mains, setMains] = React.useState([]);\r\n  const [secondaries, setSecondaries] = React.useState([]);\r\n  const [chaptersArr, setChaptersArr] = React.useState([]);\r\n\r\n  React.useEffect(() => {\r\n    getStory(router.query.id);\r\n    getChapters(router.query.id);\r\n    getStoryCharacters(router.query.id);\r\n    getStoryLocations(router.query.id);\r\n    if (!auth.isLoading) {\r\n      isStoryFavorite(router.query.id);\r\n    }\r\n  }, [router.query.id, auth]);\r\n\r\n  React.useEffect(() => {\r\n    if (actionMessage) {\r\n      message.success(actionMessage);\r\n      getChapters(router.query.id);\r\n    }\r\n  }, [actionMessage]);\r\n\r\n  const deleteChapterFunc = (id) => {\r\n    deleteChapter(id, router.query.id);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (story.mainCharacters) {\r\n      setMains(\r\n        story.mainCharacters.filter(\r\n          (c) => c.public || c.authorId === auth.user.uid\r\n        )\r\n      );\r\n    }\r\n  }, [story]);\r\n\r\n  React.useEffect(() => {\r\n    if (story.secondaryCharacters) {\r\n      setSecondaries(\r\n        story.secondaryCharacters.filter(\r\n          (c) => c.public || c.authorId === auth.user.uid\r\n        )\r\n      );\r\n    }\r\n  }, [story]);\r\n\r\n  React.useEffect(() => {\r\n    if (chapters) {\r\n      setChaptersArr(\r\n        chapters.filter((c) => c.public || c.authorId === auth.user.uid)\r\n      );\r\n    }\r\n  }, [chapters]);\r\n\r\n  return (\r\n    <LoadingScreen loading={loading}>\r\n      <LoadingScreen loading={loadingFav}>\r\n        <RedirectComp type=\"404\" condition={storyExists}>\r\n          <RedirectComp\r\n            type=\"403\"\r\n            condition={\r\n              story.public || (auth.user && auth.user.uid === story.authorId)\r\n            }\r\n          >\r\n            <div className=\"story\">\r\n              <Row gutter={24}>\r\n                <Banner\r\n                  loading={loading}\r\n                  story={story}\r\n                  id={router.query.id}\r\n                  isFavorite={isFavorite}\r\n                  addStoryToFavorite={addStoryToFavorite}\r\n                  removeStoryFromFavorite={removeStoryFromFavorite}\r\n                  auth={auth}\r\n                />\r\n                <Col sm={24} md={16} lg={18}>\r\n                  <div className=\"story-chapters\">\r\n                    <Chapters\r\n                      chapters={chaptersArr}\r\n                      id={router.query.id}\r\n                      deleteChapter={deleteChapterFunc}\r\n                    />\r\n                    <h3 className=\"heading\">Main Characters</h3>\r\n                    <CharacterGrid\r\n                      gutter={[24, 16]}\r\n                      xxl={4}\r\n                      xl={4}\r\n                      lg={4}\r\n                      md={6}\r\n                      sm={8}\r\n                      xs={12}\r\n                      type=\"show\"\r\n                      characters={mains}\r\n                    />\r\n                    <h3 className=\"heading\">Secondary Characters</h3>\r\n                    <CharacterGrid\r\n                      gutter={[24, 16]}\r\n                      xxl={4}\r\n                      xl={4}\r\n                      lg={4}\r\n                      md={6}\r\n                      sm={8}\r\n                      xs={12}\r\n                      type=\"show\"\r\n                      characters={secondaries}\r\n                    />\r\n                    <h3 className=\"heading\">Locations</h3>\r\n                    <LocationGrid\r\n                      locations={storyLocations}\r\n                      gutter={[24, 16]}\r\n                      lg={4}\r\n                      md={6}\r\n                      sm={8}\r\n                      xs={12}\r\n                      type=\"story\"\r\n                    />\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n            </div>\r\n          </RedirectComp>\r\n        </RedirectComp>\r\n      </LoadingScreen>\r\n    </LoadingScreen>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  story: state.stories.story,\r\n  loading: state.stories.loading,\r\n  chapters: state.stories.chapters,\r\n  actionMessage: state.stories.message,\r\n  loadingChapter: state.stories.loadingChapter,\r\n  isFavorite: state.stories.isFavorite,\r\n  storyExists: state.stories.storyExists,\r\n  loadingFav: state.stories.loadingFav,\r\n  storyLocations: state.stories.storyLocations,\r\n});\r\n\r\nexport default connect(mapStateToProps, {\r\n  getStory,\r\n  getChapters,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  isStoryFavorite,\r\n  addStoryToFavorite,\r\n  removeStoryFromFavorite,\r\n  getStoryLocations,\r\n})(Story);\r\n"]},"metadata":{},"sourceType":"module"}