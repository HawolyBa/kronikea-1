{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Utilisateur\\\\Documents\\\\CODE\\\\kronikea-master\\\\hooks\\\\notificationsHooks.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext, createContext } from \"react\";\nimport { auth, db } from \"../redux/fbConfig\";\nvar notificationContext = /*#__PURE__*/createContext();\nexport function ProvideNotification(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var notifications = useProvideNotification();\n  return __jsx(notificationContext.Provider, {\n    value: notifications,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 5\n    }\n  }, children);\n}\n\n_s(ProvideNotification, \"J7O0kMfYJ6l2d1GSAaB9O7mtxTc=\", false, function () {\n  return [useProvideNotification];\n});\n\n_c = ProvideNotification;\nexport var useNotifcations = function useNotifcations() {\n  _s2();\n\n  return useContext(notificationContext);\n};\n\n_s2(useNotifcations, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction useProvideNotification() {\n  _s3();\n\n  var _useState = useState(null),\n      notifications = _useState[0],\n      setNotifications = _useState[1];\n\n  var _useState2 = useState(true),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  useEffect(function () {\n    var unsubscribe = function unsubscribe() {\n      if (auth.currentUser) {\n        db.collection(\"notifications\").where(\"recipient\", \"==\", auth.currentUser.uid).onSnapshot( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(docs) {\n            var items, getUsers, users;\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    items = [];\n                    items = docs.docs.map(function (doc) {\n                      return _objectSpread(_objectSpread({}, doc.data()), {}, {\n                        id: doc.id\n                      });\n                    }).sort(function (a, b) {\n                      a = typeof a.createdAt !== \"object\" ? new Date(a.createdAt) : new Date(a.createdAt.seconds);\n                      b = typeof b.createdAt !== \"object\" ? new Date(b.createdAt) : new Date(b.createdAt.seconds);\n                      return b > a ? -1 : b < a ? 1 : 0;\n                    });\n                    console.log(items);\n                    _context.next = 5;\n                    return db.collection(\"users\").get();\n\n                  case 5:\n                    getUsers = _context.sent;\n                    _context.next = 8;\n                    return getUsers.docs.map(function (u) {\n                      return _objectSpread(_objectSpread({}, u.data()), {}, {\n                        id: u.id\n                      });\n                    });\n\n                  case 8:\n                    users = _context.sent;\n                    items = notifications.map(function (notif) {\n                      return _objectSpread(_objectSpread({}, notif), {}, {\n                        user: users.find(function (u) {\n                          return u.id === notif.sender;\n                        })\n                      });\n                    });\n                    setNotifications(items);\n\n                  case 11:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          }));\n\n          return function (_x) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n        setIsLoading(false);\n      }\n    }; // Cleanup subscription on unmount\n\n\n    return function () {\n      return unsubscribe();\n    };\n  }, [auth]);\n  return {\n    isLoading: isLoading,\n    notifications: notifications\n  };\n}\n\n_s3(useProvideNotification, \"cseqyJFNgHIuNYC0Rv2GaffV+Ws=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"ProvideNotification\");","map":{"version":3,"sources":["C:/Users/Utilisateur/Documents/CODE/kronikea-master/hooks/notificationsHooks.js"],"names":["React","useState","useEffect","useContext","createContext","auth","db","notificationContext","ProvideNotification","children","notifications","useProvideNotification","useNotifcations","setNotifications","isLoading","setIsLoading","unsubscribe","currentUser","collection","where","uid","onSnapshot","docs","items","map","doc","data","id","sort","a","b","createdAt","Date","seconds","console","log","get","getUsers","u","users","notif","user","find","sender"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext, createContext } from \"react\";\r\nimport { auth, db } from \"../redux/fbConfig\";\r\n\r\nconst notificationContext = createContext();\r\n\r\nexport function ProvideNotification({ children }) {\r\n  const notifications = useProvideNotification();\r\n  return (\r\n    <notificationContext.Provider value={notifications}>\r\n      {children}\r\n    </notificationContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useNotifcations = () => {\r\n  return useContext(notificationContext);\r\n};\r\n\r\nfunction useProvideNotification() {\r\n  const [notifications, setNotifications] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = () => {\r\n      if (auth.currentUser) {\r\n        db.collection(\"notifications\")\r\n          .where(\"recipient\", \"==\", auth.currentUser.uid)\r\n          .onSnapshot(async (docs) => {\r\n            let items = [];\r\n            items = docs.docs\r\n              .map((doc) => ({ ...doc.data(), id: doc.id }))\r\n              .sort((a, b) => {\r\n                a =\r\n                  typeof a.createdAt !== \"object\"\r\n                    ? new Date(a.createdAt)\r\n                    : new Date(a.createdAt.seconds);\r\n                b =\r\n                  typeof b.createdAt !== \"object\"\r\n                    ? new Date(b.createdAt)\r\n                    : new Date(b.createdAt.seconds);\r\n\r\n                return b > a ? -1 : b < a ? 1 : 0;\r\n              });\r\n            console.log(items);\r\n            const getUsers = await db.collection(\"users\").get();\r\n            const users = await getUsers.docs.map((u) => ({\r\n              ...u.data(),\r\n              id: u.id,\r\n            }));\r\n            items = notifications.map((notif) => ({\r\n              ...notif,\r\n              user: users.find((u) => u.id === notif.sender),\r\n            }));\r\n            setNotifications(items);\r\n          });\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    // Cleanup subscription on unmount\r\n    return () => unsubscribe();\r\n  }, [auth]);\r\n\r\n  return {\r\n    isLoading,\r\n    notifications,\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}