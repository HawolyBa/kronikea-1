{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Utilisateur\\\\Documents\\\\CODE\\\\kronikea-master\\\\hooks\\\\userHooks.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect, useContext, createContext } from \"react\";\nimport firebase from \"firebase/app\";\nimport { auth, db, storage } from \"../redux/fbConfig\";\nimport { message } from \"antd\";\nvar authContext = /*#__PURE__*/createContext();\nexport function ProvideAuth(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var auth = useProvideAuth();\n  return __jsx(authContext.Provider, {\n    value: auth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 10,\n      columnNumber: 10\n    }\n  }, children);\n}\n\n_s(ProvideAuth, \"XNU4Jn8u4aVzJknlKOHFJq03xMo=\", false, function () {\n  return [useProvideAuth];\n});\n\n_c = ProvideAuth;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(authContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction useProvideAuth() {\n  _s3();\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var _useState3 = useState({\n    password: \"\",\n    email: \"\",\n    username: \"\"\n  }),\n      errors = _useState3[0],\n      setErrors = _useState3[1]; // Wrap any Firebase methods we want to use making sure ...\n  // ... to save the user to state.\n\n\n  var signin = function signin(email, password) {\n    return auth.signInWithEmailAndPassword(email, password).then(function (response) {\n      setErrors({\n        password: \"\",\n        email: \"\"\n      });\n      setUser(response.user);\n      return response.user;\n    })[\"catch\"](function (err) {\n      if (err.code === \"auth/wrong-password\") {\n        setErrors(_objectSpread(_objectSpread({}, errors), {}, {\n          password: err.message\n        }));\n      } else if (err.code === \"auth/user-not-found\") {\n        setErrors(_objectSpread(_objectSpread({}, errors), {}, {\n          email: err.message\n        }));\n      }\n    });\n  };\n\n  var signup = function signup(email, password, username) {\n    auth.createUserWithEmailAndPassword(email, password).then( /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setErrors({\n                  password: \"\",\n                  email: \"\",\n                  username: \"\"\n                });\n                setUser(_objectSpread(_objectSpread({}, response.user), {}, {\n                  username: username\n                }));\n                _context.next = 4;\n                return db.collection(\"users\").doc(response.user.uid).set({\n                  username: username,\n                  likesCount: 0,\n                  twitter: \"\",\n                  facebook: \"\",\n                  instagram: \"\",\n                  deviantart: \"\",\n                  biography: \"\",\n                  badges: [],\n                  createdAt: firebase.firestore.FieldValue.serverTimestamp(),\n                  image: \"\",\n                  suspended: false\n                });\n\n              case 4:\n                return _context.abrupt(\"return\", _context.sent);\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }()).then(function () {\n      return auth.currentUser.sendEmailVerification();\n    })[\"catch\"](function (err) {\n      if (err.code === \"auth/email-already-in-use\" || err.code === \"auth/invalid-email\") {\n        setErrors(_objectSpread(_objectSpread({}, errors), {}, {\n          email: err.message\n        }));\n      } else if (err.code === \"auth/weak-password\") {\n        setErrors(_objectSpread(_objectSpread({}, errors), {}, {\n          password: err.message\n        }));\n      }\n    });\n  };\n\n  var signout = function signout() {\n    return auth.signOut().then(function () {\n      setUser(false);\n    });\n  };\n\n  var sendPasswordResetEmail = function sendPasswordResetEmail(email) {\n    return auth.sendPasswordResetEmail(email).then(function () {\n      return true;\n    });\n  };\n\n  var confirmPasswordReset = function confirmPasswordReset(code, password) {\n    return auth.confirmPasswordReset(code, password).then(function () {\n      return true;\n    });\n  };\n\n  var verifyEmail = function verifyEmail() {\n    auth.currentUser.sendEmailVerification().then(function () {\n      message.info(\"Verification Email sent. Check your inbox !\");\n    })[\"catch\"](function (err) {\n      message.error(err.message);\n    });\n  };\n\n  var deleteAccount = function deleteAccount() {\n    var batch = db.batch();\n    var userId = auth.currentUser.uid;\n    var allStories = db.collection(\"stories\").where(\"authorId\", \"==\", userId).get();\n    var allCharacters = db.collection(\"characters\").where(\"authorId\", \"==\", userId).get();\n    var allChapters = db.collection(\"chapters\").where(\"authorId\", \"==\", userId).get();\n    var allLocations = db.collection(\"locations\").where(\"authorId\", \"==\", userId).get();\n    var allNotifications = db.collection(\"characters\").where(\"recipient\", \"==\", userId).get();\n    var allUserLikes = db.collection(\"usersLikes\").where(\"sender\", \"==\", userId).get();\n    var allStoryLikes = db.collection(\"storiesLikes\").where(\"sender\", \"==\", userId).get();\n    var allCharactersLikes = db.collection(\"charactersLikes\").where(\"sender\", \"==\", userId).get();\n    var allComments = db.collection(\"comments\").where(\"userId\", \"==\", userId).get();\n    var allFollowers = db.collection(\"usersLikes\").where(\"recipient\", \"==\", userId).get();\n    var allStoryLiked = db.collection(\"storiesLikes\").where(\"recipient\", \"==\", userId).get();\n    var allCharactersLiked = db.collection(\"charactersLikes\").where(\"recipient\", \"==\", userId).get();\n    Promise.all([allStories, allCharacters, allNotifications, allUserLikes, allStoryLikes, allCharactersLikes, allComments, allChapters, allLocations, allFollowers, allStoryLiked, allCharactersLiked]).then(function (res) {\n      res[0].forEach(function (story) {\n        return batch[\"delete\"](db.collection(\"stories\").doc(story.id));\n      });\n      res[1].forEach(function (chara) {\n        return batch[\"delete\"](db.collection(\"characters\").doc(chara.id));\n      });\n      res[2].forEach(function (notif) {\n        return batch[\"delete\"](db.collection(\"notifications\").doc(notif.id));\n      });\n      res[3].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"usersLikes\").doc(like.id));\n      });\n      res[4].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"storiesLikes\").doc(like.id));\n      });\n      res[5].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"charactersLikes\").doc(like.id));\n      });\n      res[6].forEach(function (comment) {\n        return batch.update(db.collection(\"comment\").doc(comment.id), {\n          userDeleted: true\n        });\n      });\n      res[7].forEach(function (chap) {\n        return batch[\"delete\"](db.collection(\"chapters\").doc(chap.id));\n      });\n      res[7].forEach(function (loc) {\n        return batch[\"delete\"](db.collection(\"locations\").doc(loc.id));\n      });\n      res[7].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"usersLikes\").doc(like.id));\n      });\n      res[8].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"storiesLikes\").doc(like.id));\n      });\n      res[9].forEach(function (like) {\n        return batch[\"delete\"](db.collection(\"charactersLikes\").doc(like.id));\n      });\n      batch[\"delete\"](db.collection(\"users\").doc(userId));\n      auth.currentUser[\"delete\"]().then(function () {\n        batch.commit();\n      })[\"catch\"](function (err) {\n        return console.log(err);\n      });\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  };\n\n  useEffect(function () {\n    var unsubscribe = auth.onAuthStateChanged(function (user) {\n      if (user) {\n        setUser(user);\n\n        if (user.uid) {\n          var username = \"\";\n          setIsLoading(false);\n          db.collection(\"users\").doc(user.uid).onSnapshot(function (doc) {\n            if (doc.exists) {\n              username = doc.data().username;\n              setUser(_objectSpread(_objectSpread({}, user), {}, {\n                username: username,\n                image: doc.data().image\n              }));\n            }\n          });\n        }\n      } else {\n        setUser(false);\n        setIsLoading(false);\n      }\n    }); // Cleanup subscription on unmount\n\n    return function () {\n      return unsubscribe();\n    };\n  }, []); // Return the user object and auth methods\n\n  return {\n    deleteAccount: deleteAccount,\n    isLoading: isLoading,\n    errors: errors,\n    user: user,\n    signin: signin,\n    signup: signup,\n    signout: signout,\n    sendPasswordResetEmail: sendPasswordResetEmail,\n    confirmPasswordReset: confirmPasswordReset,\n    verifyEmail: verifyEmail\n  };\n}\n\n_s3(useProvideAuth, \"cEDdLuBwHnm3Hq/0+d+TrCNOg2c=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"ProvideAuth\");","map":{"version":3,"sources":["C:/Users/Utilisateur/Documents/CODE/kronikea-master/hooks/userHooks.js"],"names":["React","useState","useEffect","useContext","createContext","firebase","auth","db","storage","message","authContext","ProvideAuth","children","useProvideAuth","useAuth","user","setUser","isLoading","setIsLoading","password","email","username","errors","setErrors","signin","signInWithEmailAndPassword","then","response","err","code","signup","createUserWithEmailAndPassword","collection","doc","uid","set","likesCount","twitter","facebook","instagram","deviantart","biography","badges","createdAt","firestore","FieldValue","serverTimestamp","image","suspended","currentUser","sendEmailVerification","signout","signOut","sendPasswordResetEmail","confirmPasswordReset","verifyEmail","info","error","deleteAccount","batch","userId","allStories","where","get","allCharacters","allChapters","allLocations","allNotifications","allUserLikes","allStoryLikes","allCharactersLikes","allComments","allFollowers","allStoryLiked","allCharactersLiked","Promise","all","res","forEach","story","id","chara","notif","like","comment","update","userDeleted","chap","loc","commit","console","log","unsubscribe","onAuthStateChanged","onSnapshot","exists","data"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext, createContext } from \"react\";\r\nimport firebase from \"firebase/app\";\r\nimport { auth, db, storage } from \"../redux/fbConfig\";\r\nimport { message } from \"antd\";\r\n\r\nconst authContext = createContext();\r\n\r\nexport function ProvideAuth({ children }) {\r\n  const auth = useProvideAuth();\r\n  return <authContext.Provider value={auth}>{children}</authContext.Provider>;\r\n}\r\n\r\nexport const useAuth = () => {\r\n  return useContext(authContext);\r\n};\r\n\r\nfunction useProvideAuth() {\r\n  const [user, setUser] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [errors, setErrors] = useState({\r\n    password: \"\",\r\n    email: \"\",\r\n    username: \"\",\r\n  });\r\n\r\n  // Wrap any Firebase methods we want to use making sure ...\r\n  // ... to save the user to state.\r\n  const signin = (email, password) => {\r\n    return auth\r\n      .signInWithEmailAndPassword(email, password)\r\n      .then((response) => {\r\n        setErrors({ password: \"\", email: \"\" });\r\n        setUser(response.user);\r\n        return response.user;\r\n      })\r\n      .catch((err) => {\r\n        if (err.code === \"auth/wrong-password\") {\r\n          setErrors({ ...errors, password: err.message });\r\n        } else if (err.code === \"auth/user-not-found\") {\r\n          setErrors({ ...errors, email: err.message });\r\n        }\r\n      });\r\n  };\r\n\r\n  const signup = (email, password, username) => {\r\n    auth\r\n      .createUserWithEmailAndPassword(email, password)\r\n      .then(async (response) => {\r\n        setErrors({\r\n          password: \"\",\r\n          email: \"\",\r\n          username: \"\",\r\n        });\r\n        setUser({ ...response.user, username: username });\r\n        return await db.collection(\"users\").doc(response.user.uid).set({\r\n          username,\r\n          likesCount: 0,\r\n          twitter: \"\",\r\n          facebook: \"\",\r\n          instagram: \"\",\r\n          deviantart: \"\",\r\n          biography: \"\",\r\n          badges: [],\r\n          createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n          image: \"\",\r\n          suspended: false,\r\n        });\r\n      })\r\n      .then(() => {\r\n        return auth.currentUser.sendEmailVerification();\r\n      })\r\n      .catch((err) => {\r\n        if (\r\n          err.code === \"auth/email-already-in-use\" ||\r\n          err.code === \"auth/invalid-email\"\r\n        ) {\r\n          setErrors({ ...errors, email: err.message });\r\n        } else if (err.code === \"auth/weak-password\") {\r\n          setErrors({ ...errors, password: err.message });\r\n        }\r\n      });\r\n  };\r\n\r\n  const signout = () => {\r\n    return auth.signOut().then(() => {\r\n      setUser(false);\r\n    });\r\n  };\r\n\r\n  const sendPasswordResetEmail = (email) => {\r\n    return auth.sendPasswordResetEmail(email).then(() => {\r\n      return true;\r\n    });\r\n  };\r\n\r\n  const confirmPasswordReset = (code, password) => {\r\n    return auth.confirmPasswordReset(code, password).then(() => {\r\n      return true;\r\n    });\r\n  };\r\n\r\n  const verifyEmail = () => {\r\n    auth.currentUser\r\n      .sendEmailVerification()\r\n      .then(() => {\r\n        message.info(\"Verification Email sent. Check your inbox !\");\r\n      })\r\n      .catch((err) => {\r\n        message.error(err.message);\r\n      });\r\n  };\r\n\r\n  const deleteAccount = () => {\r\n    const batch = db.batch();\r\n    const userId = auth.currentUser.uid;\r\n    const allStories = db\r\n      .collection(\"stories\")\r\n      .where(\"authorId\", \"==\", userId)\r\n      .get();\r\n    const allCharacters = db\r\n      .collection(\"characters\")\r\n      .where(\"authorId\", \"==\", userId)\r\n      .get();\r\n    const allChapters = db\r\n      .collection(\"chapters\")\r\n      .where(\"authorId\", \"==\", userId)\r\n      .get();\r\n    const allLocations = db\r\n      .collection(\"locations\")\r\n      .where(\"authorId\", \"==\", userId)\r\n      .get();\r\n    const allNotifications = db\r\n      .collection(\"characters\")\r\n      .where(\"recipient\", \"==\", userId)\r\n      .get();\r\n    const allUserLikes = db\r\n      .collection(\"usersLikes\")\r\n      .where(\"sender\", \"==\", userId)\r\n      .get();\r\n    const allStoryLikes = db\r\n      .collection(\"storiesLikes\")\r\n      .where(\"sender\", \"==\", userId)\r\n      .get();\r\n    const allCharactersLikes = db\r\n      .collection(\"charactersLikes\")\r\n      .where(\"sender\", \"==\", userId)\r\n      .get();\r\n    const allComments = db\r\n      .collection(\"comments\")\r\n      .where(\"userId\", \"==\", userId)\r\n      .get();\r\n    const allFollowers = db\r\n      .collection(\"usersLikes\")\r\n      .where(\"recipient\", \"==\", userId)\r\n      .get();\r\n    const allStoryLiked = db\r\n      .collection(\"storiesLikes\")\r\n      .where(\"recipient\", \"==\", userId)\r\n      .get();\r\n    const allCharactersLiked = db\r\n      .collection(\"charactersLikes\")\r\n      .where(\"recipient\", \"==\", userId)\r\n      .get();\r\n\r\n    Promise.all([\r\n      allStories,\r\n      allCharacters,\r\n      allNotifications,\r\n      allUserLikes,\r\n      allStoryLikes,\r\n      allCharactersLikes,\r\n      allComments,\r\n      allChapters,\r\n      allLocations,\r\n      allFollowers,\r\n      allStoryLiked,\r\n      allCharactersLiked,\r\n    ])\r\n      .then((res) => {\r\n        res[0].forEach((story) =>\r\n          batch.delete(db.collection(\"stories\").doc(story.id))\r\n        );\r\n        res[1].forEach((chara) =>\r\n          batch.delete(db.collection(\"characters\").doc(chara.id))\r\n        );\r\n        res[2].forEach((notif) =>\r\n          batch.delete(db.collection(\"notifications\").doc(notif.id))\r\n        );\r\n        res[3].forEach((like) =>\r\n          batch.delete(db.collection(\"usersLikes\").doc(like.id))\r\n        );\r\n        res[4].forEach((like) =>\r\n          batch.delete(db.collection(\"storiesLikes\").doc(like.id))\r\n        );\r\n        res[5].forEach((like) =>\r\n          batch.delete(db.collection(\"charactersLikes\").doc(like.id))\r\n        );\r\n        res[6].forEach((comment) =>\r\n          batch.update(db.collection(\"comment\").doc(comment.id), {\r\n            userDeleted: true,\r\n          })\r\n        );\r\n        res[7].forEach((chap) =>\r\n          batch.delete(db.collection(\"chapters\").doc(chap.id))\r\n        );\r\n        res[7].forEach((loc) =>\r\n          batch.delete(db.collection(\"locations\").doc(loc.id))\r\n        );\r\n        res[7].forEach((like) =>\r\n          batch.delete(db.collection(\"usersLikes\").doc(like.id))\r\n        );\r\n        res[8].forEach((like) =>\r\n          batch.delete(db.collection(\"storiesLikes\").doc(like.id))\r\n        );\r\n        res[9].forEach((like) =>\r\n          batch.delete(db.collection(\"charactersLikes\").doc(like.id))\r\n        );\r\n        batch.delete(db.collection(\"users\").doc(userId));\r\n        auth.currentUser\r\n          .delete()\r\n          .then(() => {\r\n            batch.commit();\r\n          })\r\n          .catch((err) => console.log(err));\r\n      })\r\n      .catch((err) => console.log(err));\r\n  };\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = auth.onAuthStateChanged((user) => {\r\n      if (user) {\r\n        setUser(user);\r\n        if (user.uid) {\r\n          let username = \"\";\r\n          setIsLoading(false);\r\n          db.collection(\"users\")\r\n            .doc(user.uid)\r\n            .onSnapshot((doc) => {\r\n              if (doc.exists) {\r\n                username = doc.data().username;\r\n                setUser({ ...user, username, image: doc.data().image });\r\n              }\r\n            });\r\n        }\r\n      } else {\r\n        setUser(false);\r\n        setIsLoading(false);\r\n      }\r\n    });\r\n\r\n    // Cleanup subscription on unmount\r\n    return () => unsubscribe();\r\n  }, []);\r\n\r\n  // Return the user object and auth methods\r\n  return {\r\n    deleteAccount,\r\n    isLoading,\r\n    errors,\r\n    user,\r\n    signin,\r\n    signup,\r\n    signout,\r\n    sendPasswordResetEmail,\r\n    confirmPasswordReset,\r\n    verifyEmail,\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}