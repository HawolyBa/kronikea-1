{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Utilisateur\\\\Documents\\\\CODE\\\\kronikea-master\\\\pages\\\\story\\\\[id]\\\\index.js\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { useRouter } from \"next/router\";\nimport { Row, Col, message, Empty } from \"antd\";\nimport { connect } from \"react-redux\";\nimport Link from \"next/link\";\nimport { getStory, getChapters, getStoryCharacters, deleteChapter, isStoryFavorite, addStoryToFavorite, removeStoryFromFavorite, getStoryLocations, rateStory, getUserNote } from \"../../../redux/actions/storiesActions\";\nimport { useAuth } from \"../../../hooks/userHooks\";\nimport RedirectComp from \"../../../components/hoc/RedirectComp\";\nimport LoadingScreen from \"../../../components/hoc/LoadingScreen\";\nimport Chapters from \"../../../components/story/Chapters\";\nimport Banner from \"../../../components/story/Banner\";\nimport { CharacterGrid, LocationGrid } from \"../../../components/common/Grid\";\nimport RateStory from \"../../../components/common/RateStory\";\n\nconst Story = ({\n  getStory,\n  getStoryLocations,\n  story,\n  loading,\n  getChapters,\n  chapters,\n  storyLocations,\n  getStoryCharacters,\n  deleteChapter,\n  actionMessage,\n  isStoryFavorite,\n  isFavorite,\n  addStoryToFavorite,\n  storyExists,\n  loadingFav,\n  removeStoryFromFavorite,\n  rateStory,\n  getUserNote,\n  userNote\n}) => {\n  const router = useRouter();\n  const auth = useAuth();\n  const [mains, setMains] = React.useState([]);\n  const [secondaries, setSecondaries] = React.useState([]);\n  const [chaptersArr, setChaptersArr] = React.useState([]);\n  React.useEffect(() => {\n    getStory(router.query.id);\n    getChapters(router.query.id);\n    getStoryCharacters(router.query.id);\n    getStoryLocations(router.query.id);\n\n    if (!auth.isLoading) {\n      isStoryFavorite(router.query.id);\n      getUserNote(router.query.id);\n    }\n  }, [router.query.id, auth]);\n  React.useEffect(() => {\n    if (actionMessage) {\n      message.success(actionMessage);\n      getChapters(router.query.id);\n    }\n  }, [actionMessage]);\n\n  const deleteChapterFunc = id => {\n    deleteChapter(id, router.query.id);\n  };\n\n  React.useEffect(() => {\n    if (story.mainCharacters) {\n      setMains(story.mainCharacters.filter(c => c.public || c.authorId === auth.user.uid));\n    }\n  }, [story]);\n  React.useEffect(() => {\n    if (story.secondaryCharacters) {\n      setSecondaries(story.secondaryCharacters.filter(c => c.public || c.authorId === auth.user.uid));\n    }\n  }, [story]);\n  React.useEffect(() => {\n    if (!chapters.loading) {\n      setChaptersArr(chapters.items.filter(c => c.status || c.authorId === auth.user.uid).filter(chap => chap.status || chap.authorId === auth.user.uid));\n    }\n  }, [chapters]);\n  return __jsx(LoadingScreen, {\n    loading: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 5\n    }\n  }, __jsx(LoadingScreen, {\n    loading: loadingFav,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 7\n    }\n  }, __jsx(RedirectComp, {\n    type: \"404\",\n    condition: storyExists,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  }, __jsx(RedirectComp, {\n    type: \"403\",\n    condition: story.public || auth.user && auth.user.uid === story.authorId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 11\n    }\n  }, __jsx(RateStory, {\n    userNote: userNote,\n    note: story.note,\n    storyId: router.query.id,\n    rateFunc: rateStory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: \"story\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 15\n    }\n  }, __jsx(Row, {\n    gutter: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 17\n    }\n  }, __jsx(Banner, {\n    loading: loading,\n    story: story,\n    id: router.query.id,\n    isFavorite: isFavorite,\n    addStoryToFavorite: addStoryToFavorite,\n    removeStoryFromFavorite: removeStoryFromFavorite,\n    auth: auth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 19\n    }\n  }), __jsx(Col, {\n    sm: 24,\n    md: 16,\n    lg: 18,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: \"story-chapters\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: \"justify-between chapter-cta\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 23\n    }\n  }, __jsx(\"h3\", {\n    className: \"chap-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 25\n    }\n  }, \"Chapters\"), auth.user && auth.user.uid === story.authorId && __jsx(Link, {\n    href: `/story/${story.id}/chapter/new`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 27\n    }\n  }, __jsx(\"a\", {\n    className: \"add-btn-text add-chapter-btn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 29\n    }\n  }, __jsx(\"ion-icon\", {\n    name: \"add-circle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 31\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 31\n    }\n  }, \"Add a new chapter\")))), chaptersArr.length > 0 ? __jsx(Chapters, {\n    auth: auth,\n    loading: chapters.loading,\n    chapters: chaptersArr,\n    id: router.query.id,\n    deleteChapter: deleteChapterFunc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 25\n    }\n  }) : __jsx(Empty, {\n    image: Empty.PRESENTED_IMAGE_SIMPLE,\n    description: \"No chapters yet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 25\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 23\n    }\n  }, \"Main Characters\"), __jsx(CharacterGrid, {\n    gutter: \"16px\",\n    xxl: 4,\n    xl: 4,\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"show\",\n    columnsCountBreakPoints: {\n      350: 1,\n      750: 2,\n      900: 3,\n      1200: 4,\n      1600: 4\n    },\n    characters: mains,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 23\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 23\n    }\n  }, \"Secondary Characters\"), __jsx(CharacterGrid, {\n    gutter: \"16px\",\n    xxl: 4,\n    xl: 4,\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"show\",\n    columnsCountBreakPoints: {\n      350: 1,\n      750: 2,\n      900: 3,\n      1200: 4,\n      1600: 4\n    },\n    characters: secondaries,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 23\n    }\n  }), __jsx(\"h3\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 23\n    }\n  }, \"Locations\"), __jsx(LocationGrid, {\n    locations: storyLocations,\n    gutter: \"16px\",\n    columnsCountBreakPoints: {\n      350: 1,\n      750: 2,\n      900: 3,\n      1200: 4,\n      1600: 4\n    },\n    lg: 4,\n    md: 6,\n    sm: 8,\n    xs: 12,\n    type: \"story\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 23\n    }\n  }))))))))));\n};\n\nconst mapStateToProps = state => ({\n  story: state.stories.story,\n  loading: state.stories.loading,\n  chapters: state.stories.chapters,\n  actionMessage: state.stories.message,\n  loadingChapter: state.stories.loadingChapter,\n  isFavorite: state.stories.isFavorite,\n  storyExists: state.stories.storyExists,\n  loadingFav: state.stories.loadingFav,\n  storyLocations: state.stories.storyLocations,\n  userNote: state.stories.userNote\n});\n\nexport default connect(mapStateToProps, {\n  getStory,\n  getChapters,\n  getStoryCharacters,\n  deleteChapter,\n  isStoryFavorite,\n  addStoryToFavorite,\n  removeStoryFromFavorite,\n  getStoryLocations,\n  rateStory,\n  getUserNote\n})(Story);","map":{"version":3,"sources":["C:/Users/Utilisateur/Documents/CODE/kronikea-master/pages/story/[id]/index.js"],"names":["React","useRouter","Row","Col","message","Empty","connect","Link","getStory","getChapters","getStoryCharacters","deleteChapter","isStoryFavorite","addStoryToFavorite","removeStoryFromFavorite","getStoryLocations","rateStory","getUserNote","useAuth","RedirectComp","LoadingScreen","Chapters","Banner","CharacterGrid","LocationGrid","RateStory","Story","story","loading","chapters","storyLocations","actionMessage","isFavorite","storyExists","loadingFav","userNote","router","auth","mains","setMains","useState","secondaries","setSecondaries","chaptersArr","setChaptersArr","useEffect","query","id","isLoading","success","deleteChapterFunc","mainCharacters","filter","c","public","authorId","user","uid","secondaryCharacters","items","status","chap","note","length","PRESENTED_IMAGE_SIMPLE","mapStateToProps","state","stories","loadingChapter"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { Row, Col, message, Empty } from \"antd\";\r\nimport { connect } from \"react-redux\";\r\nimport Link from \"next/link\";\r\n\r\nimport {\r\n  getStory,\r\n  getChapters,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  isStoryFavorite,\r\n  addStoryToFavorite,\r\n  removeStoryFromFavorite,\r\n  getStoryLocations,\r\n  rateStory,\r\n  getUserNote,\r\n} from \"../../../redux/actions/storiesActions\";\r\nimport { useAuth } from \"../../../hooks/userHooks\";\r\n\r\nimport RedirectComp from \"../../../components/hoc/RedirectComp\";\r\nimport LoadingScreen from \"../../../components/hoc/LoadingScreen\";\r\nimport Chapters from \"../../../components/story/Chapters\";\r\nimport Banner from \"../../../components/story/Banner\";\r\nimport { CharacterGrid, LocationGrid } from \"../../../components/common/Grid\";\r\nimport RateStory from \"../../../components/common/RateStory\";\r\n\r\nconst Story = ({\r\n  getStory,\r\n  getStoryLocations,\r\n  story,\r\n  loading,\r\n  getChapters,\r\n  chapters,\r\n  storyLocations,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  actionMessage,\r\n  isStoryFavorite,\r\n  isFavorite,\r\n  addStoryToFavorite,\r\n  storyExists,\r\n  loadingFav,\r\n  removeStoryFromFavorite,\r\n  rateStory,\r\n  getUserNote,\r\n  userNote,\r\n}) => {\r\n  const router = useRouter();\r\n  const auth = useAuth();\r\n\r\n  const [mains, setMains] = React.useState([]);\r\n  const [secondaries, setSecondaries] = React.useState([]);\r\n  const [chaptersArr, setChaptersArr] = React.useState([]);\r\n\r\n  React.useEffect(() => {\r\n    getStory(router.query.id);\r\n    getChapters(router.query.id);\r\n    getStoryCharacters(router.query.id);\r\n    getStoryLocations(router.query.id);\r\n\r\n    if (!auth.isLoading) {\r\n      isStoryFavorite(router.query.id);\r\n      getUserNote(router.query.id);\r\n    }\r\n  }, [router.query.id, auth]);\r\n\r\n  React.useEffect(() => {\r\n    if (actionMessage) {\r\n      message.success(actionMessage);\r\n      getChapters(router.query.id);\r\n    }\r\n  }, [actionMessage]);\r\n\r\n  const deleteChapterFunc = (id) => {\r\n    deleteChapter(id, router.query.id);\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (story.mainCharacters) {\r\n      setMains(\r\n        story.mainCharacters.filter(\r\n          (c) => c.public || c.authorId === auth.user.uid\r\n        )\r\n      );\r\n    }\r\n  }, [story]);\r\n\r\n  React.useEffect(() => {\r\n    if (story.secondaryCharacters) {\r\n      setSecondaries(\r\n        story.secondaryCharacters.filter(\r\n          (c) => c.public || c.authorId === auth.user.uid\r\n        )\r\n      );\r\n    }\r\n  }, [story]);\r\n\r\n  React.useEffect(() => {\r\n    if (!chapters.loading) {\r\n      setChaptersArr(\r\n        chapters.items\r\n          .filter((c) => c.status || c.authorId === auth.user.uid)\r\n          .filter((chap) => chap.status || chap.authorId === auth.user.uid)\r\n      );\r\n    }\r\n  }, [chapters]);\r\n\r\n  return (\r\n    <LoadingScreen loading={loading}>\r\n      <LoadingScreen loading={loadingFav}>\r\n        <RedirectComp type=\"404\" condition={storyExists}>\r\n          <RedirectComp\r\n            type=\"403\"\r\n            condition={\r\n              story.public || (auth.user && auth.user.uid === story.authorId)\r\n            }\r\n          >\r\n            <RateStory\r\n              userNote={userNote}\r\n              note={story.note}\r\n              storyId={router.query.id}\r\n              rateFunc={rateStory}\r\n            >\r\n              <div className=\"story\">\r\n                <Row gutter={24}>\r\n                  <Banner\r\n                    loading={loading}\r\n                    story={story}\r\n                    id={router.query.id}\r\n                    isFavorite={isFavorite}\r\n                    addStoryToFavorite={addStoryToFavorite}\r\n                    removeStoryFromFavorite={removeStoryFromFavorite}\r\n                    auth={auth}\r\n                  />\r\n                  <Col sm={24} md={16} lg={18}>\r\n                    <div className=\"story-chapters\">\r\n                      <div className=\"justify-between chapter-cta\">\r\n                        <h3 className=\"chap-title\">Chapters</h3>\r\n                        {auth.user && auth.user.uid === story.authorId && (\r\n                          <Link href={`/story/${story.id}/chapter/new`}>\r\n                            <a className=\"add-btn-text add-chapter-btn\">\r\n                              <ion-icon name=\"add-circle\"></ion-icon>\r\n                              <span>Add a new chapter</span>\r\n                            </a>\r\n                          </Link>\r\n                        )}\r\n                      </div>\r\n                      {chaptersArr.length > 0 ? (\r\n                        <Chapters\r\n                          auth={auth}\r\n                          loading={chapters.loading}\r\n                          chapters={chaptersArr}\r\n                          id={router.query.id}\r\n                          deleteChapter={deleteChapterFunc}\r\n                        />\r\n                      ) : (\r\n                        <Empty\r\n                          image={Empty.PRESENTED_IMAGE_SIMPLE}\r\n                          description=\"No chapters yet\"\r\n                        />\r\n                      )}\r\n\r\n                      <h3 className=\"heading\">Main Characters</h3>\r\n                      <CharacterGrid\r\n                        gutter={\"16px\"}\r\n                        xxl={4}\r\n                        xl={4}\r\n                        lg={4}\r\n                        md={6}\r\n                        sm={8}\r\n                        xs={12}\r\n                        type=\"show\"\r\n                        columnsCountBreakPoints={{\r\n                          350: 1,\r\n                          750: 2,\r\n                          900: 3,\r\n                          1200: 4,\r\n                          1600: 4,\r\n                        }}\r\n                        characters={mains}\r\n                      />\r\n                      <h3 className=\"heading\">Secondary Characters</h3>\r\n                      <CharacterGrid\r\n                        gutter={\"16px\"}\r\n                        xxl={4}\r\n                        xl={4}\r\n                        lg={4}\r\n                        md={6}\r\n                        sm={8}\r\n                        xs={12}\r\n                        type=\"show\"\r\n                        columnsCountBreakPoints={{\r\n                          350: 1,\r\n                          750: 2,\r\n                          900: 3,\r\n                          1200: 4,\r\n                          1600: 4,\r\n                        }}\r\n                        characters={secondaries}\r\n                      />\r\n                      <h3 className=\"heading\">Locations</h3>\r\n                      <LocationGrid\r\n                        locations={storyLocations}\r\n                        gutter={\"16px\"}\r\n                        columnsCountBreakPoints={{\r\n                          350: 1,\r\n                          750: 2,\r\n                          900: 3,\r\n                          1200: 4,\r\n                          1600: 4,\r\n                        }}\r\n                        lg={4}\r\n                        md={6}\r\n                        sm={8}\r\n                        xs={12}\r\n                        type=\"story\"\r\n                      />\r\n                    </div>\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n            </RateStory>\r\n          </RedirectComp>\r\n        </RedirectComp>\r\n      </LoadingScreen>\r\n    </LoadingScreen>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  story: state.stories.story,\r\n  loading: state.stories.loading,\r\n  chapters: state.stories.chapters,\r\n  actionMessage: state.stories.message,\r\n  loadingChapter: state.stories.loadingChapter,\r\n  isFavorite: state.stories.isFavorite,\r\n  storyExists: state.stories.storyExists,\r\n  loadingFav: state.stories.loadingFav,\r\n  storyLocations: state.stories.storyLocations,\r\n  userNote: state.stories.userNote,\r\n});\r\n\r\nexport default connect(mapStateToProps, {\r\n  getStory,\r\n  getChapters,\r\n  getStoryCharacters,\r\n  deleteChapter,\r\n  isStoryFavorite,\r\n  addStoryToFavorite,\r\n  removeStoryFromFavorite,\r\n  getStoryLocations,\r\n  rateStory,\r\n  getUserNote,\r\n})(Story);\r\n"]},"metadata":{},"sourceType":"module"}