{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Utilisateur\\\\Documents\\\\CODE\\\\kronikea-master\\\\hooks\\\\notificationsHooks.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect, useContext, createContext } from \"react\";\nimport { auth, db } from \"../redux/fbConfig\";\nconst notificationContext = /*#__PURE__*/createContext();\nexport function ProvideNotification({\n  children\n}) {\n  const notifications = useProvideNotification();\n  return __jsx(notificationContext.Provider, {\n    value: notifications,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 5\n    }\n  }, children);\n}\nexport const useNotifcations = () => {\n  return useContext(notificationContext);\n};\n\nfunction useProvideNotification() {\n  const {\n    0: notifications,\n    1: setNotifications\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true);\n  const {\n    0: count,\n    1: setCount\n  } = useState(0);\n\n  const markAsRead = id => db.collection(\"notifications\").doc(id).update({\n    read: true\n  });\n\n  const deleteOne = id => db.collection(\"notifications\").doc(id).delete();\n\n  useEffect(() => {\n    const unsubscribe = auth.onAuthStateChanged(user => {\n      if (user.uid) {\n        db.collection(\"notifications\").where(\"recipient\", \"==\", auth.currentUser.uid).onSnapshot(async docs => {\n          let items = [];\n          items = docs.docs.map(doc => _objectSpread(_objectSpread({}, doc.data()), {}, {\n            id: doc.id\n          })).sort((a, b) => {\n            a = typeof a.createdAt !== \"object\" ? new Date(a.createdAt) : new Date(a.createdAt.seconds);\n            b = typeof b.createdAt !== \"object\" ? new Date(b.createdAt) : new Date(b.createdAt.seconds);\n            return b > a ? -1 : b < a ? 1 : 0;\n          });\n          const getUsers = await db.collection(\"users\").get();\n          const users = await getUsers.docs.map(u => _objectSpread(_objectSpread({}, u.data()), {}, {\n            id: u.id\n          }));\n          items = items.map(notif => _objectSpread(_objectSpread({}, notif), {}, {\n            user: users.find(u => u.id === notif.sender)\n          }));\n          setNotifications(items);\n        });\n        setIsLoading(false);\n      }\n    }); // Cleanup subscription on unmount\n\n    return () => unsubscribe();\n  }, [auth]);\n  useEffect(() => {\n    setCount(notifications.filter(n => !n.read).length);\n  }, [notifications]);\n  return {\n    isLoading,\n    items: notifications,\n    markAsRead,\n    count,\n    deleteOne\n  };\n}","map":{"version":3,"sources":["C:/Users/Utilisateur/Documents/CODE/kronikea-master/hooks/notificationsHooks.js"],"names":["React","useState","useEffect","useContext","createContext","auth","db","notificationContext","ProvideNotification","children","notifications","useProvideNotification","useNotifcations","setNotifications","isLoading","setIsLoading","count","setCount","markAsRead","id","collection","doc","update","read","deleteOne","delete","unsubscribe","onAuthStateChanged","user","uid","where","currentUser","onSnapshot","docs","items","map","data","sort","a","b","createdAt","Date","seconds","getUsers","get","users","u","notif","find","sender","filter","n","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext, createContext } from \"react\";\r\nimport { auth, db } from \"../redux/fbConfig\";\r\n\r\nconst notificationContext = createContext();\r\n\r\nexport function ProvideNotification({ children }) {\r\n  const notifications = useProvideNotification();\r\n  return (\r\n    <notificationContext.Provider value={notifications}>\r\n      {children}\r\n    </notificationContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useNotifcations = () => {\r\n  return useContext(notificationContext);\r\n};\r\n\r\nfunction useProvideNotification() {\r\n  const [notifications, setNotifications] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [count, setCount] = useState(0);\r\n\r\n  const markAsRead = (id) =>\r\n    db.collection(\"notifications\").doc(id).update({ read: true });\r\n\r\n  const deleteOne = (id) => db.collection(\"notifications\").doc(id).delete();\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = auth.onAuthStateChanged((user) => {\r\n      if (user.uid) {\r\n        db.collection(\"notifications\")\r\n          .where(\"recipient\", \"==\", auth.currentUser.uid)\r\n          .onSnapshot(async (docs) => {\r\n            let items = [];\r\n            items = docs.docs\r\n              .map((doc) => ({ ...doc.data(), id: doc.id }))\r\n              .sort((a, b) => {\r\n                a =\r\n                  typeof a.createdAt !== \"object\"\r\n                    ? new Date(a.createdAt)\r\n                    : new Date(a.createdAt.seconds);\r\n                b =\r\n                  typeof b.createdAt !== \"object\"\r\n                    ? new Date(b.createdAt)\r\n                    : new Date(b.createdAt.seconds);\r\n\r\n                return b > a ? -1 : b < a ? 1 : 0;\r\n              });\r\n            const getUsers = await db.collection(\"users\").get();\r\n            const users = await getUsers.docs.map((u) => ({\r\n              ...u.data(),\r\n              id: u.id,\r\n            }));\r\n            items = items.map((notif) => ({\r\n              ...notif,\r\n              user: users.find((u) => u.id === notif.sender),\r\n            }));\r\n            setNotifications(items);\r\n          });\r\n        setIsLoading(false);\r\n      }\r\n    });\r\n\r\n    // Cleanup subscription on unmount\r\n    return () => unsubscribe();\r\n  }, [auth]);\r\n\r\n  useEffect(() => {\r\n    setCount(notifications.filter((n) => !n.read).length);\r\n  }, [notifications]);\r\n\r\n  return {\r\n    isLoading,\r\n    items: notifications,\r\n    markAsRead,\r\n    count,\r\n    deleteOne,\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}